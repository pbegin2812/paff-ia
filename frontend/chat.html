
<!DOCTYPE html>
<html>
<head>
  <title>PaffIA Chat</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
<div id="app">
  <div id="sidebar">
    <h2>PaffIA</h2>
    <button class="gradient-red primary" onclick="newChat()">+ New Chat</button>
    <ul id="history"></ul>
  </div>

  <div id="chat">
    <div id="messages"></div>
    <div id="input">
      <input id="msg" placeholder="Type a message..." />
      <button onclick="send()">Send</button>
    </div>
  </div>
</div>

<script>
let history = [];

function addMessage(role, text) {
  const div = document.createElement("div");
  div.className = "message " + role;

  if (text.includes("```")) {
    const pre = document.createElement("pre");
    const btn = document.createElement("button");
    btn.innerText = "Copy";
    btn.className = "copy-btn";
    btn.onclick = () => navigator.clipboard.writeText(text.replace(/```/g,""));
    pre.appendChild(btn);
    pre.appendChild(document.createTextNode(text.replace(/```/g,"")));
    div.appendChild(pre);
  } else {
    div.innerText = text;
  }

  document.getElementById("messages").appendChild(div);
}

function send() {
  const input = document.getElementById("msg");
  addMessage("user", input.value);
  fetch("/bridge", {
    method: "POST",
    body: JSON.stringify({message: input.value, history: history})
  })
  .then(r => r.text())
  .then(t => addMessage("ai", t));
  input.value = "";
}

function newChat() {
  document.getElementById("messages").innerHTML = "";
}
</script>
</body>
</html>
